<!-- Advanced Prompt Details Modal -->
<div id="prompt-details-modal" class="modal">
    <div class="modal-content" style="max-width: 800px; max-height: 90vh; overflow-y: auto;">
        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 24px; position: sticky; top: 0; background: rgba(26, 26, 31, 0.95); padding-bottom: 16px; border-bottom: 1px solid rgba(124, 58, 237, 0.2);">
            <div>
                <div class="modal-header" id="detail-title">–î–µ—Ç–∞–ª–∏ –ü—Ä–æ–º–ø—Ç–∞</div>
                <div id="detail-category" style="font-size: 12px; color: var(--primary-400); text-transform: uppercase; margin-top: 8px;"></div>
            </div>
            <button style="background: transparent; border: none; color: var(--dark-400); font-size: 24px; cursor: pointer; padding: 0;" onclick="closePromptDetailsModal()">‚úï</button>
        </div>

        <!-- Tabs -->
        <div style="display: flex; gap: 12px; margin-bottom: 24px; border-bottom: 1px solid rgba(124, 58, 237, 0.2); padding-bottom: 12px;">
            <button class="tab-btn active" onclick="switchDetailTab('view')" style="background: transparent; border: none; color: var(--primary-400); cursor: pointer; padding: 8px 16px; border-bottom: 2px solid var(--primary-600); font-weight: 600;">üìñ –ü—Ä–æ—Å–º–æ—Ç—Ä</button>
            <button class="tab-btn" onclick="switchDetailTab('edit')" style="background: transparent; border: none; color: var(--dark-400); cursor: pointer; padding: 8px 16px; font-weight: 600;">‚úèÔ∏è –†–µ–¥–∞–∫—Ç.</button>
            <button class="tab-btn" onclick="switchDetailTab('keywords')" style="background: transparent; border: none; color: var(--dark-400); cursor: pointer; padding: 8px 16px; font-weight: 600;">üè∑Ô∏è –ö–ª—é—á–∏</button>
        </div>

        <!-- View Tab -->
        <div id="view-tab" class="detail-tab">
            <div style="background: rgba(124, 58, 237, 0.08); border: 1px solid rgba(124, 58, 237, 0.2); border-radius: 12px; padding: 16px; margin-bottom: 20px;">
                <div style="color: var(--dark-400); font-size: 12px; text-transform: uppercase; margin-bottom: 8px;">–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ</div>
                <div id="detail-content" style="color: var(--dark-300); line-height: 1.8; white-space: pre-wrap; font-family: 'Monaco', 'Courier', monospace; font-size: 13px;"></div>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 20px;">
                <div style="background: rgba(236, 72, 153, 0.08); border: 1px solid rgba(236, 72, 153, 0.2); border-radius: 12px; padding: 16px;">
                    <div style="color: var(--dark-400); font-size: 12px; text-transform: uppercase; margin-bottom: 8px;">–í–µ—Ä—Å–∏—è</div>
                    <div id="detail-version" style="color: var(--dark-300); font-size: 14px; font-weight: 600;"></div>
                </div>
                <div style="background: rgba(6, 182, 212, 0.08); border: 1px solid rgba(6, 182, 212, 0.2); border-radius: 12px; padding: 16px;">
                    <div style="color: var(--dark-400); font-size: 12px; text-transform: uppercase; margin-bottom: 8px;">–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π</div>
                    <div id="detail-usage" style="color: var(--dark-300); font-size: 14px; font-weight: 600;"></div>
                </div>
            </div>

            <div style="display: flex; gap: 12px;">
                <button class="btn btn-primary" onclick="copyPromptContent()" style="flex: 1;">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
                <button class="btn btn-secondary" onclick="exportPromptTxt()" style="flex: 1;">üíæ –≠–∫—Å–ø–æ—Ä—Ç TXT</button>
                <button class="btn btn-secondary" onclick="translatePrompt()" style="flex: 1;">üåç –ü–µ—Ä–µ–≤–æ–¥</button>
            </div>
        </div>

        <!-- Edit Tab -->
        <div id="edit-tab" class="detail-tab" style="display: none;">
            <form onsubmit="savePromptChanges(event)" style="display: flex; flex-direction: column; gap: 20px;">
                <div class="form-group">
                    <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ</label>
                    <input type="text" id="edit-title" class="form-input" required>
                </div>

                <div class="form-group">
                    <label class="form-label">–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ</label>
                    <textarea id="edit-content" class="form-textarea" required style="min-height: 250px;"></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                    <input type="text" id="edit-description" class="form-input">
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                    <div class="form-group">
                        <label class="form-label">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                        <select id="edit-category" class="form-input" style="cursor: pointer;">
                            <option>general</option>
                            <option>writing</option>
                            <option>coding</option>
                            <option>analysis</option>
                            <option>creative</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">–í–µ—Ä—Å–∏—è</label>
                        <input type="text" id="edit-version" class="form-input">
                    </div>
                </div>

                <div style="display: flex; gap: 12px;">
                    <button type="button" class="btn btn-secondary" onclick="closePromptDetailsModal()" style="flex: 1;">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="btn btn-primary" style="flex: 1;">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                </div>
            </form>
        </div>

        <!-- Keywords Tab -->
        <div id="keywords-tab" class="detail-tab" style="display: none;">
            <div style="margin-bottom: 20px;">
                <h4 style="color: white; margin-bottom: 12px; font-size: 14px; text-transform: uppercase; letter-spacing: 0.5px;">–í—ã–¥–µ–ª–µ–Ω–Ω—ã–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞:</h4>
                <div id="keywords-list" style="background: rgba(124, 58, 237, 0.08); border: 1px solid rgba(124, 58, 237, 0.2); border-radius: 12px; padding: 16px; min-height: 200px;">
                    <p style="color: var(--dark-400);">–ó–∞–≥—Ä—É–∑–∫–∞ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤...</p>
                </div>
            </div>

            <div style="margin-bottom: 20px;">
                <h4 style="color: white; margin-bottom: 12px; font-size: 14px; text-transform: uppercase; letter-spacing: 0.5px;">–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã–µ —Ç–µ–≥–∏:</h4>
                <div id="suggested-tags" style="display: flex; flex-wrap: wrap; gap: 8px;">
                    <span style="color: var(--dark-400);">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                </div>
            </div>

            <button class="btn btn-primary" onclick="autoTagPrompt()" style="width: 100%;">‚ö° –ü–µ—Ä–µ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å</button>
        </div>
    </div>
</div>

<!-- Project Details Modal -->
<div id="project-details-modal" class="modal">
    <div class="modal-content" style="max-width: 900px; max-height: 90vh; overflow-y: auto;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; padding-bottom: 16px; border-bottom: 1px solid rgba(124, 58, 237, 0.2);">
            <div class="modal-header" id="project-title">–ü—Ä–æ–µ–∫—Ç</div>
            <button style="background: transparent; border: none; color: var(--dark-400); font-size: 24px; cursor: pointer;" onclick="closeProjectDetailsModal()">‚úï</button>
        </div>

        <!-- Project Tabs -->
        <div style="display: flex; gap: 12px; margin-bottom: 24px; border-bottom: 1px solid rgba(124, 58, 237, 0.2); padding-bottom: 12px;">
            <button class="tab-btn active" onclick="switchProjectTab('tasks')" style="background: transparent; border: none; color: var(--primary-400); cursor: pointer; padding: 8px 16px; border-bottom: 2px solid var(--primary-600); font-weight: 600;">‚úì –ó–∞–¥–∞—á–∏</button>
            <button class="tab-btn" onclick="switchProjectTab('process')" style="background: transparent; border: none; color: var(--dark-400); cursor: pointer; padding: 8px 16px; font-weight: 600;">‚öôÔ∏è –ü—Ä–æ—Ü–µ—Å—Å</button>
            <button class="tab-btn" onclick="switchProjectTab('info')" style="background: transparent; border: none; color: var(--dark-400); cursor: pointer; padding: 8px 16px; font-weight: 600;">‚ÑπÔ∏è –ò–Ω—Ñ–æ</button>
        </div>

        <!-- Tasks Tab -->
        <div id="tasks-tab" class="project-tab">
            <textarea id="tasks-editor" class="form-textarea" style="min-height: 400px; font-family: 'Monaco', 'Courier', monospace; font-size: 13px;" placeholder="–î–æ–±–∞–≤—å—Ç–µ –∑–∞–¥–∞—á–∏ –∑–¥–µ—Å—å..."></textarea>
            <button class="btn btn-primary" onclick="saveProjectTasks()" style="margin-top: 16px; width: 100%;">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∑–∞–¥–∞—á–∏</button>
        </div>

        <!-- Process Tab -->
        <div id="process-tab" class="project-tab" style="display: none;">
            <textarea id="process-editor" class="form-textarea" style="min-height: 400px; font-family: 'Monaco', 'Courier', monospace; font-size: 13px;" placeholder="–û–ø–∏—à–∏—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å –∑–¥–µ—Å—å..."></textarea>
            <button class="btn btn-primary" onclick="saveProjectProcess()" style="margin-top: 16px; width: 100%;">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å</button>
        </div>

        <!-- Info Tab -->
        <div id="info-tab" class="project-tab" style="display: none;">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div style="background: rgba(124, 58, 237, 0.08); border: 1px solid rgba(124, 58, 237, 0.2); border-radius: 12px; padding: 16px;">
                    <div style="color: var(--dark-400); font-size: 12px; text-transform: uppercase; margin-bottom: 8px;">–°—Ç–∞—Ç—É—Å</div>
                    <div id="project-status" style="color: var(--dark-300); font-size: 14px; font-weight: 600;"></div>
                </div>
                <div style="background: rgba(236, 72, 153, 0.08); border: 1px solid rgba(236, 72, 153, 0.2); border-radius: 12px; padding: 16px;">
                    <div style="color: var(--dark-400); font-size: 12px; text-transform: uppercase; margin-bottom: 8px;">–û–ø–∏—Å–∞–Ω–∏–µ</div>
                    <div id="project-desc" style="color: var(--dark-300); font-size: 13px; line-height: 1.6;"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Category Tabs for Prompts Page -->
<div id="category-tabs-container" style="display: none; margin-bottom: 20px; display: flex; gap: 8px; overflow-x: auto; padding-bottom: 12px; border-bottom: 1px solid rgba(124, 58, 237, 0.2);">
    <button class="category-tab active" onclick="filterByCategory('all')" data-category="all" style="background: linear-gradient(135deg, var(--primary-600), var(--accent-1)); color: white; border: none; padding: 8px 16px; border-radius: 8px; cursor: pointer; font-weight: 600; white-space: nowrap;">üîπ –í—Å–µ</button>
    <!-- Categories will be populated dynamically -->
</div>

<style>
.tab-btn { transition: all 0.3s ease; }
.tab-btn:hover { color: var(--primary-400) !important; }
.detail-tab { animation: fadeInUp 0.3s ease-out; }
.project-tab { animation: fadeInUp 0.3s ease-out; }
.category-tab { transition: all 0.3s ease; }
.category-tab:hover { transform: translateY(-2px); opacity: 0.9; }
.category-tab.active { box-shadow: 0 8px 20px rgba(124, 58, 237, 0.4); }
</style>

<script>
let currentPromptId = null;
let currentProjectId = null;
let currentDetailTab = 'view';
let currentProjectTab = 'tasks';
let currentCategory = 'all';

// Switch tabs in prompt details modal
function switchDetailTab(tabName) {
    currentDetailTab = tabName;
    
    // Hide all tabs
    document.querySelectorAll('.detail-tab').forEach(t => t.style.display = 'none');
    
    // Show selected tab
    const tab = document.getElementById(tabName + '-tab');
    if (tab) tab.style.display = 'block';
    
    // Update tab buttons
    document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.style.borderBottomColor = 'transparent';
        btn.style.color = 'var(--dark-400)';
    });
    event.target.style.borderBottomColor = 'var(--primary-600)';
    event.target.style.color = 'var(--primary-400)';
    
    // Load keywords if switching to keywords tab
    if (tabName === 'keywords' && currentPromptId) {
        loadPromptKeywords(currentPromptId);
    }
}

// Switch tabs in project details modal
function switchProjectTab(tabName) {
    currentProjectTab = tabName;
    
    // Hide all tabs
    document.querySelectorAll('.project-tab').forEach(t => t.style.display = 'none');
    
    // Show selected tab
    const tab = document.getElementById(tabName + '-tab');
    if (tab) tab.style.display = 'block';
    
    // Update tab buttons
    document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.style.borderBottomColor = 'transparent';
        btn.style.color = 'var(--dark-400)';
    });
    event.target.style.borderBottomColor = 'var(--primary-600)';
    event.target.style.color = 'var(--primary-400)';
    
    // Load content if switching to tasks/process
    if (currentProjectId) {
        if (tabName === 'tasks') loadProjectTasks(currentProjectId);
        if (tabName === 'process') loadProjectProcess(currentProjectId);
    }
}

// Open prompt details modal
async function openPromptDetailsModal(promptId) {
    currentPromptId = promptId;
    const modal = document.getElementById('prompt-details-modal');
    if (!modal) return;
    
    try {
        const response = await fetch(`${API_URL}/api/prompts/${promptId}`);
        const prompt = await response.json();
        
        // Populate view tab
        document.getElementById('detail-title').textContent = prompt.title || '–ü—Ä–æ–º–ø—Ç';
        document.getElementById('detail-category').textContent = prompt.category || 'general';
        document.getElementById('detail-content').textContent = prompt.content;
        document.getElementById('detail-version').textContent = prompt.version || '1.0';
        document.getElementById('detail-usage').textContent = prompt.usage_count || '0';
        
        // Populate edit tab
        document.getElementById('edit-title').value = prompt.title;
        document.getElementById('edit-content').value = prompt.content;
        document.getElementById('edit-description').value = prompt.description || '';
        document.getElementById('edit-category').value = prompt.category;
        document.getElementById('edit-version').value = prompt.version || '1.0';
        
        modal.classList.add('active');
        
        // Load keywords
        loadPromptKeywords(promptId);
    } catch (error) {
        console.error('Error opening prompt:', error);
    }
}

function closePromptDetailsModal() {
    const modal = document.getElementById('prompt-details-modal');
    if (modal) modal.classList.remove('active');
    currentPromptId = null;
}

// Load and display keywords
async function loadPromptKeywords(promptId) {
    try {
        const response = await fetch(`${API_URL}/api/prompts/${promptId}`);
        const prompt = await response.json();
        
        // Extract keywords
        const keywordsResponse = await fetch(`${API_URL}/api/prompts/extract-keywords`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ content: prompt.content })
        });
        
        const keywordData = await keywordsResponse.json();
        
        // Display keywords
        const keywordsList = document.getElementById('keywords-list');
        if (keywordData.keywords && keywordData.keywords.length > 0) {
            keywordsList.innerHTML = `
                <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                    ${keywordData.keywords.map(kw => `
                        <span style="background: rgba(124, 58, 237, 0.2); border: 1px solid rgba(124, 58, 237, 0.4); padding: 6px 12px; border-radius: 6px; font-size: 12px; color: var(--primary-400); font-weight: 600;">[[${kw}]]</span>
                    `).join('')}
                </div>
            `;
        } else {
            keywordsList.innerHTML = '<p style="color: var(--dark-400);">–ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>';
        }
        
        // Auto-tag
        autoTagPrompt();
    } catch (error) {
        console.error('Error loading keywords:', error);
    }
}

// Auto-tag prompt
async function autoTagPrompt() {
    if (!currentPromptId) return;
    
    try {
        const response = await fetch(`${API_URL}/api/prompts/${currentPromptId}/auto-tag`);
        const data = await response.json();
        
        const tagsContainer = document.getElementById('suggested-tags');
        if (data.suggested_tags && data.suggested_tags.length > 0) {
            tagsContainer.innerHTML = data.suggested_tags.map(tag => `
                <span style="background: linear-gradient(135deg, var(--primary-600), var(--accent-1)); color: white; padding: 6px 12px; border-radius: 6px; font-size: 12px; font-weight: 600; cursor: pointer;" onclick="addTagToPrompt('${tag}')">${tag}</span>
            `).join('');
        } else {
            tagsContainer.innerHTML = '<span style="color: var(--dark-400);">–¢–µ–≥–∏ –Ω–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω—ã</span>';
        }
    } catch (error) {
        console.error('Error auto-tagging:', error);
    }
}

// Copy prompt content
function copyPromptContent() {
    const content = document.getElementById('detail-content').textContent;
    navigator.clipboard.writeText(content).then(() => {
        alert('‚úÖ –ü—Ä–æ–º–ø—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!');
    }).catch(err => {
        console.error('Copy failed:', err);
        alert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–∏');
    });
}

// Export as TXT
async function exportPromptTxt() {
    if (!currentPromptId) return;
    
    try {
        const response = await fetch(`${API_URL}/api/prompts/${currentPromptId}/export-txt`, { method: 'POST' });
        const data = await response.json();
        alert('‚úÖ –ü—Ä–æ–º–ø—Ç —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω –≤ —Ñ–∞–π–ª!');
    } catch (error) {
        alert('‚ùå –û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞');
    }
}

// Translate prompt (placeholder)
function translatePrompt() {
    alert('üåç –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–≤–æ–¥–∞ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ —Å–∫–æ—Ä–æ!');
}

// Save prompt changes
async function savePromptChanges(event) {
    event.preventDefault();
    if (!currentPromptId) return;
    
    const data = {
        title: document.getElementById('edit-title').value,
        content: document.getElementById('edit-content').value,
        description: document.getElementById('edit-description').value,
        category: document.getElementById('edit-category').value,
        version: document.getElementById('edit-version').value
    };
    
    try {
        const response = await fetch(`${API_URL}/api/prompts/${currentPromptId}`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
        });
        
        if (response.ok) {
            alert('‚úÖ –ü—Ä–æ–º–ø—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω!');
            closePromptDetailsModal();
            loadPrompts();
        } else {
            alert('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è');
        }
    } catch (error) {
        console.error('Error saving:', error);
    }
}

// Project functions
async function openProjectDetailsModal(projectId) {
    currentProjectId = projectId;
    const modal = document.getElementById('project-details-modal');
    if (!modal) return;
    
    try {
        const response = await fetch(`${API_URL}/api/projects/${projectId}`);
        const project = await response.json();
        
        document.getElementById('project-title').textContent = project.name;
        document.getElementById('project-status').textContent = project.status;
        document.getElementById('project-desc').textContent = project.description || '–ù–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è';
        
        modal.classList.add('active');
        
        // Load tasks and process
        loadProjectTasks(projectId);
    } catch (error) {
        console.error('Error opening project:', error);
    }
}

function closeProjectDetailsModal() {
    const modal = document.getElementById('project-details-modal');
    if (modal) modal.classList.remove('active');
    currentProjectId = null;
}

async function loadProjectTasks(projectId) {
    try {
        const response = await fetch(`${API_URL}/api/projects/${projectId}/tasks`);
        const data = await response.json();
        document.getElementById('tasks-editor').value = data.content || '';
    } catch (error) {
        console.error('Error loading tasks:', error);
    }
}

async function loadProjectProcess(projectId) {
    try {
        const response = await fetch(`${API_URL}/api/projects/${projectId}/process`);
        const data = await response.json();
        document.getElementById('process-editor').value = data.content || '';
    } catch (error) {
        console.error('Error loading process:', error);
    }
}

async function saveProjectTasks() {
    if (!currentProjectId) return;
    
    const content = document.getElementById('tasks-editor').value;
    
    try {
        const response = await fetch(`${API_URL}/api/projects/${currentProjectId}/tasks`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ content })
        });
        
        if (response.ok) {
            alert('‚úÖ –ó–∞–¥–∞—á–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!');
        } else {
            alert('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è');
        }
    } catch (error) {
        console.error('Error saving:', error);
    }
}

async function saveProjectProcess() {
    if (!currentProjectId) return;
    
    const content = document.getElementById('process-editor').value;
    
    try {
        const response = await fetch(`${API_URL}/api/projects/${currentProjectId}/process`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ content })
        });
        
        if (response.ok) {
            alert('‚úÖ –ü—Ä–æ—Ü–µ—Å—Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω!');
        } else {
            alert('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è');
        }
    } catch (error) {
        console.error('Error saving:', error);
    }
}

// Filter by category
async function filterByCategory(category) {
    currentCategory = category;
    
    // Update button styles
    document.querySelectorAll('.category-tab').forEach(btn => {
        btn.classList.remove('active');
    });
    event.target.classList.add('active');
    
    // Load prompts for category
    loadPrompts();
}

// Update loadPrompts to support categories
async function loadPromptsOriginal() {
    try {
        let url = `${API_URL}/api/prompts`;
        if (currentCategory && currentCategory !== 'all') {
            url = `${API_URL}/api/prompts/by-category/${currentCategory}`;
        }
        
        const response = await fetch(url);
        const data = await response.json();
        const prompts = data.prompts || data;
        
        const container = document.getElementById('prompts-list');
        if (!prompts || prompts.length === 0) {
            container.innerHTML = '<p style="font-size: 16px; color: var(--dark-400);">–ü—Ä–æ–º–ø—Ç–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</p>';
        } else {
            container.innerHTML = `<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 16px;">
                ${prompts.map(p => `
                    <div style="background: rgba(124, 58, 237, 0.1); border: 1px solid rgba(124, 58, 237, 0.2); border-radius: 12px; padding: 16px; cursor: pointer; transition: all 0.3s ease;" 
                         onmouseover="this.style.borderColor='rgba(168, 85, 247, 0.4)'; this.style.background='rgba(124, 58, 237, 0.15)'" 
                         onmouseout="this.style.borderColor='rgba(124, 58, 237, 0.2)'; this.style.background='rgba(124, 58, 237, 0.1)'"
                         onclick="openPromptDetailsModal(${p.id})">
                        <h3 style="color: white; margin-bottom: 8px; font-size: 14px; font-weight: 700;">${p.title}</h3>
                        <p style="color: var(--dark-400); font-size: 12px; margin-bottom: 12px; height: 40px; overflow: hidden;">${p.content.substring(0, 60)}...</p>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span style="font-size: 11px; color: var(--primary-400); text-transform: uppercase;">${p.category}</span>
                            <span style="font-size: 11px; color: var(--dark-400);">üëÅÔ∏è ${p.usage_count || 0}</span>
                        </div>
                    </div>
                `).join('')}
            </div>`;
        }
    } catch (error) {
        console.error('Error loading prompts:', error);
    }
}

// Load categories for tabs
async function loadCategories() {
    try {
        const response = await fetch(`${API_URL}/api/prompts/categories`);
        const data = await response.json();
        
        const container = document.getElementById('category-tabs-container');
        if (data.categories && data.categories.length > 0) {
            const icons = {
                'writing': '‚úçÔ∏è',
                'coding': 'üíª',
                'analysis': 'üìä',
                'creative': 'üé®',
                'general': 'üîπ'
            };
            
            let html = '<button class="category-tab active" onclick="filterByCategory(\'all\')" data-category="all" style="background: linear-gradient(135deg, var(--primary-600), var(--accent-1)); color: white; border: none; padding: 8px 16px; border-radius: 8px; cursor: pointer; font-weight: 600; white-space: nowrap; transition: all 0.3s ease;">üîπ –í—Å–µ</button>';
            
            data.categories.forEach(cat => {
                html += `<button class="category-tab" onclick="filterByCategory('${cat}')" data-category="${cat}" style="background: rgba(124, 58, 237, 0.1); border: 1px solid rgba(124, 58, 237, 0.2); color: var(--dark-300); border: none; padding: 8px 16px; border-radius: 8px; cursor: pointer; font-weight: 600; white-space: nowrap; transition: all 0.3s ease;">${icons[cat] || 'üè∑Ô∏è'} ${cat}</button>`;
            });
            
            container.innerHTML = html;
            container.style.display = 'flex';
        }
    } catch (error) {
        console.error('Error loading categories:', error);
    }
}

// Initialize when page loads
document.addEventListener('DOMContentLoaded', () => {
    loadCategories();
});
</script>
