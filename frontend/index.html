<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="PANDORA - –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä –ø–æ–¥—Å–∫–∞–∑–æ–∫ –∏ –ø—Ä–æ–º–ø—Ç–æ–≤ –¥–ª—è AI">
    <meta name="theme-color" content="#6366F1">
    <title>PANDORA v2.0 - –ú–µ–Ω–µ–¥–∂–µ—Ä –ø—Ä–æ–º–ø—Ç–æ–≤</title>

    <!-- Preconnect –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞–≥—Ä—É–∑–∫–∏ —à—Ä–∏—Ñ—Ç–æ–≤ -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">

    <!-- –ì–ª–∞–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Å—Ç–∏–ª–µ–π v2.0 (–∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω–æ–µ) -->
    <link rel="stylesheet" href="css/styles.css">

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='75' font-size='75' font-family='system-ui' fill='%236366F1'>P</text></svg>">
</head>
<body>
    <div id="app" class="app-layout">
        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
             NAVBAR
             ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <nav class="navbar">
            <div class="navbar-container">
                <div class="navbar-brand">
                    <a href="/" class="flex items-center gap-2">
                        <span class="text-2xl">üé®</span>
                        <span class="font-bold text-lg">PANDORA</span>
                    </a>
                </div>
                
                <div class="navbar-search">
                    <input 
                        type="text" 
                        class="input" 
                        placeholder="–ü–æ–∏—Å–∫ –ø—Ä–æ–º–ø—Ç–æ–≤..."
                        data-action="focus-search"
                    >
                </div>

                <div class="navbar-actions flex gap-2 items-center">
                    <div class="stat-badge">
                        <div class="stat-number" id="header-prompts">0</div>
                        <div class="stat-label">–ü—Ä–æ–º–ø—Ç—ã</div>
                    </div>
                    <div class="stat-badge">
                        <div class="stat-number" id="header-projects">0</div>
                        <div class="stat-label">–ü—Ä–æ–µ–∫—Ç—ã</div>
                    </div>
                    <div class="stat-badge">
                        <div class="stat-number" id="header-tags">0</div>
                        <div class="stat-label">–¢–µ–≥–∏</div>
                    </div>
                    <button id="theme-toggle" class="btn btn-ghost" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">
                        üåô
                    </button>
                </div>
            </div>
        </nav>

        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
             MAIN LAYOUT (SIDEBAR + CONTENT)
             ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <div class="main-layout">
            <!-- SIDEBAR –ù–ê–í–ò–ì–ê–¶–ò–Ø -->
            <aside class="sidebar-wrapper">
                <!-- –®–∞–ø–∫–∞ sidebar -->
                <div class="sidebar-header">
                    <h2 class="text-lg font-bold">–ú–µ–Ω—é</h2>
                </div>

                <!-- –û—Å–Ω–æ–≤–Ω–æ–µ –º–µ–Ω—é -->
                <nav class="sidebar-nav">
                    <button class="nav-link active" data-page="dashboard">
                        <span>üìä</span>
                        <span>Dashboard</span>
                    </button>
                    <button class="nav-link" data-page="prompts">
                        <span>‚ú®</span>
                        <span>–ü—Ä–æ–º–ø—Ç—ã</span>
                    </button>
                    <button class="nav-link" data-page="projects">
                        <span>üìÅ</span>
                        <span>–ü—Ä–æ–µ–∫—Ç—ã</span>
                    </button>
                    <button class="nav-link" data-page="tags">
                        <span>üè∑Ô∏è</span>
                        <span>–¢–µ–≥–∏</span>
                    </button>
                    <button class="nav-link" data-page="import">
                        <span>üì•</span>
                        <span>–ò–º–ø–æ—Ä—Ç</span>
                    </button>
                    <button class="nav-link" data-page="settings">
                        <span>‚öôÔ∏è</span>
                        <span>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</span>
                    </button>
                </nav>
            </aside>

            <!-- –û–°–ù–û–í–ù–û–ï –°–û–î–ï–†–ñ–ò–ú–û–ï -->
            <main class="content-wrapper">
                <!-- Dashboard Page -->
                <div id="dashboard" class="page active">
                    <div class="page-header">
                        <h1 class="page-title">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ PANDORA</h1>
                        <p class="page-subtitle">–í–∞—à AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–º–ø—Ç–∞–º–∏ –∏ –ø—Ä–æ–µ–∫—Ç–∞–º–∏</p>
                    </div>

                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value">
                                <span id="stat-prompts">0</span>
                            </div>
                            <div class="stat-label">–ü—Ä–æ–º–ø—Ç–æ–≤</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">
                                <span id="stat-projects">0</span>
                            </div>
                            <div class="stat-label">–ü—Ä–æ–µ–∫—Ç–æ–≤</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">
                                <span id="stat-tags">0</span>
                            </div>
                            <div class="stat-label">–¢–µ–≥–æ–≤</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">
                                <span id="stat-categories">0</span>
                            </div>
                            <div class="stat-label">–ö–∞—Ç–µ–≥–æ—Ä–∏–π</div>
                        </div>
                    </div>

                    <div class="section mt-12">
                        <h2 class="text-2xl font-bold mb-6">–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç</h2>
                        <p class="text-neutral-400 leading-relaxed mb-6">
                            PANDORA - —ç—Ç–æ —Ä–µ–≤–æ–ª—é—Ü–∏–æ–Ω–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è AI –ø—Ä–æ–º–ø—Ç–∞–º–∏. –°–æ–∑–¥–∞–≤–∞–π—Ç–µ, –æ—Ä–≥–∞–Ω–∏–∑—É–π—Ç–µ –∏ –¥–µ–ª–∏—Ç–µ—Å—å –≤–∞—à–∏–º–∏ –ø—Ä–æ–º–ø—Ç–∞–º–∏ —Å –º–∏—Ä–æ–º. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –ò–ò –¥–ª—è –∞–≤—Ç–æ—Ç–µ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤–∞—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö.
                        </p>
                        <button class="btn btn-primary" data-action="open-prompt-modal">
                            ‚ûï –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–º–ø—Ç
                        </button>
                    </div>
                </div>

                <!-- Prompts Page -->
                <div id="prompts" class="page">
                    <div class="page-header">
                        <h1 class="page-title">–í–∞—à–∏ –ü—Ä–æ–º–ø—Ç—ã</h1>
                        <p class="page-subtitle">–£–ø—Ä–∞–≤–ª—è–π—Ç–µ –∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ –≤–∞—à—É –∫–æ–ª–ª–µ–∫—Ü–∏—é –ø—Ä–æ–º–ø—Ç–æ–≤</p>
                    </div>

                    <div class="mb-8">
                        <button class="btn btn-primary" data-action="open-prompt-modal">
                            ‚ûï –ù–æ–≤—ã–π –ü—Ä–æ–º–ø—Ç
                        </button>
                    </div>

                    <div id="prompts-list" class="empty-state">
                        <p>–ó–∞–≥—Ä—É–∂–∞—é –ø—Ä–æ–º–ø—Ç—ã...</p>
                    </div>
                </div>

                <!-- Projects Page -->
                <div id="projects" class="page">
                    <div class="page-header">
                        <h1 class="page-title">–í–∞—à–∏ –ü—Ä–æ–µ–∫—Ç—ã</h1>
                        <p class="page-subtitle">–û—Ä–≥–∞–Ω–∏–∑—É–π—Ç–µ —Ä–∞–±–æ—Ç—É –ø–æ –ø—Ä–æ–µ–∫—Ç–∞–º –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ –ø—Ä–æ–≥—Ä–µ—Å—Å</p>
                    </div>

                    <div class="mb-8">
                        <button class="btn btn-primary" data-action="open-project-modal">
                            ‚ûï –ù–æ–≤—ã–π –ü—Ä–æ–µ–∫—Ç
                        </button>
                    </div>

                    <div id="projects-list" class="empty-state">
                        <p>–ó–∞–≥—Ä—É–∂–∞—é –ø—Ä–æ–µ–∫—Ç—ã...</p>
                    </div>
                </div>

                <!-- Tags Page -->
                <div id="tags" class="page">
                    <div class="page-header">
                        <h1 class="page-title">–¢–µ–≥–∏ –∏ –ö–∞—Ç–µ–≥–æ—Ä–∏–∏</h1>
                        <p class="page-subtitle">–£–ø—Ä–∞–≤–ª—è–π—Ç–µ —Ç–µ–≥–∞–º–∏ –¥–ª—è –ª—É—á—à–µ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏</p>
                    </div>

                    <div id="tags-list" class="empty-state">
                        <p>–ó–∞–≥—Ä—É–∂–∞—é —Ç–µ–≥–∏...</p>
                    </div>
                </div>

                <!-- Import Page -->
                <div id="import" class="page">
                    <div class="page-header">
                        <h1 class="page-title">–ò–º–ø–æ—Ä—Ç –î–∞–Ω–Ω—ã—Ö</h1>
                        <p class="page-subtitle">–ó–∞–≥—Ä—É–∑–∏—Ç–µ –ø—Ä–æ–º–ø—Ç—ã –∏–∑ JSON —Ñ–∞–π–ª–∞</p>
                    </div>

                    <div class="card mt-8">
                        <div class="card-body">
                            <div class="text-center">
                                <p class="text-neutral-400 mb-6">–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ JSON —Ñ–∞–π–ª —Å—é–¥–∞ –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª</p>
                                <input type="file" id="import-file" accept=".json" style="display: none;" />
                                <button class="btn btn-primary" onclick="document.getElementById('import-file').click();">
                                    üìÇ –í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Settings Page -->
                <div id="settings" class="page">
                    <div class="page-header">
                        <h1 class="page-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h1>
                        <p class="page-subtitle">–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ –¥–∞–Ω–Ω—ã–µ</p>
                    </div>

                    <div class="card mt-8">
                        <div class="card-header">
                            <h3>–û –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏</h3>
                        </div>
                        <div class="card-body">
                            <p class="mb-3"><strong>–í–µ—Ä—Å–∏—è:</strong> 2.0.0 Premium</p>
                            <p class="mb-3"><strong>Backend:</strong> FastAPI + SQLite</p>
                            <p class="mb-6"><strong>–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:</strong> 9 –¥–µ–∫–∞–±—Ä—è 2025</p>
                            
                            <div class="flex gap-3">
                                <button class="btn btn-secondary" onclick="alert('–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö...');">
                                    üì§ –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         MODALS
         ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->

    <!-- PROMPT MODAL -->
    <div id="prompt-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>–ù–æ–≤—ã–π –ü—Ä–æ–º–ø—Ç</h2>
                <button class="modal-close" data-action="close-modal">‚úï</button>
            </div>
            
            <form id="prompt-form" class="form-grid">
                <div class="form-group">
                    <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ</label>
                    <input type="text" id="prompt-title" class="input" required placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞">
                </div>

                <div class="form-group">
                    <label class="form-label">–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ</label>
                    <textarea id="prompt-content" class="input" required placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞" style="min-height: 120px;"></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
                    <input type="text" id="prompt-description" class="input" placeholder="–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ">
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                        <select id="prompt-category" class="input">
                            <option>general</option>
                            <option>writing</option>
                            <option>coding</option>
                            <option>analysis</option>
                            <option>creative</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">–í–µ—Ä—Å–∏—è</label>
                        <input type="text" id="prompt-version" class="input" placeholder="1.0" value="1.0">
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-action="close-modal">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="btn btn-primary">–°–æ–∑–¥–∞—Ç—å</button>
                </div>
            </form>
        </div>
    </div>

    <!-- PROJECT MODAL -->
    <div id="project-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>–ù–æ–≤—ã–π –ü—Ä–æ–µ–∫—Ç</h2>
                <button class="modal-close" data-action="close-modal">‚úï</button>
            </div>
            
            <form id="project-form" class="form-grid">
                <div class="form-group">
                    <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞</label>
                    <input type="text" id="project-name" class="input" required placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞">
                </div>

                <div class="form-group">
                    <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                    <textarea id="project-description" class="input" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞" style="min-height: 100px;"></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">–°—Ç–∞—Ç—É—Å</label>
                    <select id="project-status" class="input">
                        <option>active</option>
                        <option>paused</option>
                        <option>completed</option>
                        <option>archived</option>
                    </select>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-action="close-modal">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="btn btn-primary">–°–æ–∑–¥–∞—Ç—å</button>
                </div>
            </form>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="js/app.js"></script>
    <script src="js/modals.js"></script>
    <script>
        const API_URL = 'http://127.0.0.1:8000';
        
        // Theme Toggle
        document.getElementById('theme-toggle').addEventListener('click', () => {
            if (window.App && window.App.theme) {
                window.App.theme.toggleTheme();
            }
        });

        // Page Navigation
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', (e) => {
                const pageName = e.currentTarget.dataset.page;
                switchPage(pageName);
                
                document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                e.currentTarget.classList.add('active');
            });
        });

        // Modal Actions
        document.querySelectorAll('[data-action="open-prompt-modal"]').forEach(btn => {
            btn.addEventListener('click', openPromptModal);
        });

        document.querySelectorAll('[data-action="open-project-modal"]').forEach(btn => {
            btn.addEventListener('click', openProjectModal);
        });

        document.querySelectorAll('[data-action="close-modal"]').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const modal = e.target.closest('.modal');
                if (modal) modal.classList.remove('active');
            });
        });

        // Close modals on background click
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.classList.remove('active');
                }
            });
        });

        function switchPage(pageName) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            
            // Show selected page
            const page = document.getElementById(pageName);
            if (page) {
                page.classList.add('active');
                
                // Load page-specific data
                if (pageName === 'dashboard') {
                    loadStats();
                } else if (pageName === 'prompts') {
                    loadPrompts();
                } else if (pageName === 'projects') {
                    loadProjects();
                } else if (pageName === 'tags') {
                    loadTags();
                }
            }
        }

        async function loadStats() {
            try {
                const response = await fetch(`${API_URL}/api/stats`);
                const data = await response.json();

                const updateStatWithAnimation = (elementId, value) => {
                    const element = document.getElementById(elementId);
                    if (element) {
                        element.textContent = value || 0;
                    }
                };

                updateStatWithAnimation('stat-prompts', data.total_prompts);
                updateStatWithAnimation('stat-tags', data.total_tags);
                updateStatWithAnimation('stat-projects', data.total_projects);
                updateStatWithAnimation('stat-categories', data.total_categories);

                updateStatWithAnimation('header-prompts', data.total_prompts);
                updateStatWithAnimation('header-projects', data.total_projects);
                updateStatWithAnimation('header-tags', data.total_tags);
            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }

        function openPromptModal() {
            const modal = document.getElementById('prompt-modal');
            if (modal) {
                modal.classList.add('active');
                document.getElementById('prompt-form').reset();
            }
        }

        async function createPrompt(event) {
            event.preventDefault();
            
            const title = document.getElementById('prompt-title').value;
            const content = document.getElementById('prompt-content').value;
            const description = document.getElementById('prompt-description').value || '';
            const category = document.getElementById('prompt-category').value || 'general';
            const version = document.getElementById('prompt-version').value || '1.0';
            
            try {
                const response = await fetch(`${API_URL}/api/prompts`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        title,
                        content,
                        description,
                        category,
                        version,
                        tag_ids: []
                    })
                });
                
                if (response.ok) {
                    document.getElementById('prompt-modal').classList.remove('active');
                    showToast('‚úÖ –ü—Ä–æ–º–ø—Ç —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!', 'success');
                    await loadPrompts();
                    await loadStats();
                }
            } catch (error) {
                console.error('Error creating prompt:', error);
                showToast('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø—Ä–æ–º–ø—Ç–∞', 'error');
            }
        }

        async function loadPrompts() {
            try {
                const response = await fetch(`${API_URL}/api/prompts`);
                const prompts = await response.json();
                
                const container = document.getElementById('prompts-list');
                if (prompts.length === 0) {
                    container.innerHTML = '<div class="empty-state"><p>–ü—Ä–æ–º–ø—Ç–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.</p></div>';
                } else {
                    const cardsHtml = prompts.map(p => `
                        <div class="card card-item">
                            <div class="card-body">
                                <h3 class="font-semibold mb-2">${p.title}</h3>
                                <p class="text-sm text-neutral-400 mb-4 line-clamp-2">${p.content.substring(0, 80)}...</p>
                                <div class="flex justify-between items-center">
                                    <span class="badge badge-primary">${p.category}</span>
                                    <button class="btn btn-ghost btn-sm" onclick="deletePrompt(${p.id})">üóëÔ∏è</button>
                                </div>
                            </div>
                        </div>
                    `).join('');
                    
                    container.innerHTML = `<div class="grid gap-4 grid-cols-auto-fill">${cardsHtml}</div>`;
                }
            } catch (error) {
                console.error('Error loading prompts:', error);
                document.getElementById('prompts-list').innerHTML = '<p class="text-neutral-400">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</p>';
            }
        }

        async function deletePrompt(id) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –ø—Ä–æ–º–ø—Ç?')) return;
            
            try {
                await fetch(`${API_URL}/api/prompts/${id}`, { method: 'DELETE' });
                await loadPrompts();
                await loadStats();
                showToast('–ü—Ä–æ–º–ø—Ç —É–¥–∞–ª—ë–Ω', 'success');
            } catch (error) {
                console.error('Error:', error);
            }
        }

        function openProjectModal() {
            const modal = document.getElementById('project-modal');
            if (modal) {
                modal.classList.add('active');
                document.getElementById('project-form').reset();
            }
        }

        async function createProject(event) {
            event.preventDefault();
            
            const name = document.getElementById('project-name').value;
            const description = document.getElementById('project-description').value || '';
            const status = document.getElementById('project-status').value || 'active';
            
            try {
                const response = await fetch(`${API_URL}/api/projects`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        name,
                        description,
                        status
                    })
                });
                
                if (response.ok) {
                    document.getElementById('project-modal').classList.remove('active');
                    showToast('‚úÖ –ü—Ä–æ–µ–∫—Ç —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!', 'success');
                    await loadProjects();
                    await loadStats();
                }
            } catch (error) {
                console.error('Error:', error);
                showToast('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞', 'error');
            }
        }

        async function loadProjects() {
            try {
                const response = await fetch(`${API_URL}/api/projects`);
                const projects = await response.json();
                
                const container = document.getElementById('projects-list');
                if (projects.length === 0) {
                    container.innerHTML = '<div class="empty-state"><p>–ü—Ä–æ–µ–∫—Ç–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.</p></div>';
                } else {
                    const cardsHtml = projects.map(p => `
                        <div class="card card-item">
                            <div class="card-body">
                                <h3 class="font-semibold mb-2">${p.name}</h3>
                                <p class="text-sm text-neutral-400 mb-4">${p.description || '–ù–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è'}</p>
                                <div class="flex justify-between items-center">
                                    <span class="badge badge-accent">${p.status}</span>
                                    <button class="btn btn-ghost btn-sm" onclick="deleteProject(${p.id})">üóëÔ∏è</button>
                                </div>
                            </div>
                        </div>
                    `).join('');
                    
                    container.innerHTML = `<div class="grid gap-4 grid-cols-auto-fill">${cardsHtml}</div>`;
                }
            } catch (error) {
                console.error('Error:', error);
            }
        }

        async function deleteProject(id) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç?')) return;
            
            try {
                await fetch(`${API_URL}/api/projects/${id}`, { method: 'DELETE' });
                await loadProjects();
                await loadStats();
                showToast('–ü—Ä–æ–µ–∫—Ç —É–¥–∞–ª—ë–Ω', 'success');
            } catch (error) {
                console.error('Error:', error);
            }
        }

        async function loadTags() {
            try {
                const promptsResp = await fetch(`${API_URL}/api/prompts`);
                const prompts = await promptsResp.json();
                
                const tagsByCategory = {};
                
                prompts.forEach(p => {
                    if (!tagsByCategory[p.category]) {
                        tagsByCategory[p.category] = [];
                    }
                    p.tags?.forEach(t => {
                        if (!tagsByCategory[p.category].find(tag => tag.id === t.id)) {
                            tagsByCategory[p.category].push(t);
                        }
                    });
                });
                
                const container = document.getElementById('tags-list');
                if (Object.keys(tagsByCategory).length === 0) {
                    container.innerHTML = '<p class="text-neutral-400">–¢–µ–≥–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.</p>';
                } else {
                    const categoriesHtml = Object.entries(tagsByCategory).map(([category, tags]) => `
                        <div class="mb-8">
                            <h3 class="text-primary-400 mb-4 text-capitalize font-semibold">${category}</h3>
                            <div class="flex flex-wrap gap-2">
                                ${tags.map(t => `
                                    <button class="badge badge-primary cursor-pointer hover:badge-accent">
                                        ${t.name}
                                    </button>
                                `).join('')}
                            </div>
                        </div>
                    `).join('');
                    container.innerHTML = categoriesHtml;
                }
            } catch (error) {
                console.error('Error:', error);
            }
        }

        function showToast(message, type = 'info') {
            if (window.App && window.App.ui) {
                window.App.ui.showToast(message, type);
            } else {
                alert(message);
            }
        }

        // Form submit handlers
        document.getElementById('prompt-form')?.addEventListener('submit', createPrompt);
        document.getElementById('project-form')?.addEventListener('submit', createProject);

        // Initialize
        async function waitForAPI() {
            let attempts = 0;
            const maxAttempts = 30;
            
            while (attempts < maxAttempts) {
                try {
                    const response = await fetch(`${API_URL}/api/stats`, { 
                        signal: AbortSignal.timeout(2000) 
                    });
                    if (response.ok) {
                        console.log('‚úÖ API –≥–æ—Ç–æ–≤');
                        loadStats();
                        return;
                    }
                } catch (error) {
                    attempts++;
                    console.log(`‚è≥ –û–∂–∏–¥–∞—é API... (${attempts}/${maxAttempts})`);
                    await new Promise(resolve => setTimeout(resolve, 1000));
                }
            }
            console.error('‚ùå API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
        }

        window.addEventListener('load', waitForAPI);
    </script>
</body>
</html>
